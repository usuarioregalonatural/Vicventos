/*! Thrive Leads - The ultimate Lead Capture solution for wordpress - 2016-11-18
* https://thrivethemes.com 
* Copyright (c) 2016 * Thrive Themes */
!function(a,b){var c,d="_tcb_link_placeholder",e=(b("body").append(TVE.tpl("tve-link-inline-template")),/^(mailto:)?[a-z0-9._%+-]+@[a-z0-9][a-z0-9.-]*\.[a-z]{2,63}$/i),f=/^https?:\/\/([^\s\/?.#-][^\s\/?.#]*\.?)+(\/[^\s"]*)?$/i,g=/^https?:\/\/[^\/]+\.[^\/]+($|\/)/i,h=TVE.Views.ControlBase.extend({initialize:function(){this.$checkbox=this.$('input[type="checkbox"]'),this.$el.add(this.$('input[type="checkbox"]')).on("click mousedown",function(a){a.preventDefault()}).on("mousedown",_.bind(this.toggle,this))},toggle:function(a){var b=this.checked();this.$checkbox.prop("checked",!b),this.$el[b?"removeClass":"addClass"]("tcb-checked"),a.stopPropagation(),a.preventDefault()},checked:function(){return this.$checkbox.prop("checked")},check:function(){return this.$checkbox.prop("checked",!0),this.$el.addClass("tcb-checked"),this},uncheck:function(){return this.$checkbox.prop("checked",!1),this.$el.removeClass("tcb-checked"),this},set:function(a){return this[a?"check":"uncheck"]()}}),i=TVE.Views.Component.extend({el:b("#tcb-inline-link")[0],_dirty:!0,$link_node:null,$autocomplete:null,width:320,state:"edit",controls:{},link:{text:"",href:"",target:"",rel:""},initialize:function(){this.$=b,this.$autocomplete=this.$("#tcb-link-search"),this.$text=this.$("#tcb-link-text");var a=this;this.$(".tcb-checkbox").each(function(){a.controls[this.getAttribute("data-name")]=new h({el:this})}),this.$el.on("click mousedown",function(a){a.preventDefault()}).find("input").on("mousedown click",function(a){a.stopPropagation()}),a.bind_autocomplete()},bind_autocomplete:function(){var a,c,d=this;this.$autocomplete.autocomplete({source:function(e,f){return a===e.term?void f(c):/^https?:/.test(e.term)||-1!==e.term.indexOf(".")?(d.set_link_text(e.term),f()):(b.post(tve_path_params.ajax_url,{action:"tve_find_quick_link_contents",json:"1",q:e.term},function(a){c=a,f(a)},"json"),void(a=e.term))},focus:function(a,b){a.preventDefault()},select:function(a,b){return d.$autocomplete.val(b.item.url),d.set_link_text(b.item.title),!1},open:function(){d.$autocomplete.attr("aria-expanded","true")},close:function(){d.$autocomplete.attr("aria-expanded","false")},minLength:2,delay:200,position:{my:"left top+2"},messages:{noResults:"undefined"!=typeof window.uiAutocompleteL10n?window.uiAutocompleteL10n.noResults:"",results:function(a){return"undefined"!=typeof window.uiAutocompleteL10n?a>1?window.uiAutocompleteL10n.manyResults.replace("%d",a):window.uiAutocompleteL10n.oneResult:void 0}}}).autocomplete("instance")._renderItem=function(a,c){return b('<li role="option" id="mce-tcb-autocomplete-'+c.id+'">').append("<span>"+c.label+'</span>&nbsp;<span class="tcb-link-type">'+c.type+"</span>").appendTo(a)},d.$autocomplete.attr({role:"combobox","aria-autocomplete":"list","aria-expanded":"false","aria-owns":d.$autocomplete.autocomplete("widget").attr("id")}).on("focus",function(){var a=d.$autocomplete.val();a&&!/^https?:/.test(a)&&d.$autocomplete.autocomplete("search")}).autocomplete("widget").addClass("tcb-link-autocomplete").attr("role","listbox").removeAttr("tabindex").on("menufocus",function(a,b){b.item.attr("aria-selected","true")}).on("menublur",function(){b(this).find('[aria-selected="true"]').removeAttr("aria-selected")})},render:function(){return this},set_link_node:function(a){return this.$link_node&&this.$link_node[0]===a||(this._dirty=!0,this.$link_node=b(a)),this.has_link_text=b.trim(this.$link_node.text()),this},reposition:function(){if(!this._dirty)return this;this._dirty=!1;var a=this.$link_node.offset();return this.$el.css({top:a.top+this.$link_node.outerHeight()+"px",left:a.left+this.$link_node.outerWidth()/2+"px"}),this},preview:function(){return this.state="preview",this.$(".tcb-link-component").hide().filter(".tcb-preview").show(),this.show()},edit:function(){this.state="edit",this.$(".tcb-link-component").hide().filter(".tcb-edit").show(),this.show();var a=this;return setTimeout(function(){a.$autocomplete.focus()}),this},on_node_change:function(){var a=this.$link_node.attr("href"),b=this.$link_node.attr("data-tcblink-edit");return a===d||b?(a===d||this.get_url()||this.$autocomplete.val(a),this.controls.target.set("_blank"===this.$link_node.attr("target")),this.controls.rel.set("nofollow"===this.$link_node.attr("rel")),this.$text.val(this.$link_node.text()),this.edit()):a?(this.set_preview_url(a),"true"===this.$link_node.attr("data-tcblink-url-error")?this.$(".wp-link-preview a").addClass("tcb-url-error"):(this.$(".wp-link-preview a").removeClass("tcb-url-error"),this.has_link_error=!1),this.preview()):this},reset:function(){return this.$("input").val(""),this.controls.target.uncheck(),this.controls.rel.uncheck(),this._dirty=!0,this.has_link_text=!1,this},get_url:function(){var a=b.trim(this.$autocomplete.val());return!a||/^(?:[a-z]+:|#|\?|\.|\/)/.test(a)||e.test(a)||(a="http://"+a),a},get_text:function(){return b.trim(this.$text.val())},set_preview_url:function(a){var b,c;this.url!==a&&(this.url=a,a=window.decodeURIComponent(a),a=a.replace(/^(?:https?:)?\/\/(?:www\.)?/,""),-1!==(b=a.indexOf("?"))&&(a=a.slice(0,b)),-1!==(b=a.indexOf("#"))&&(a=a.slice(0,b)),a=a.replace(/(?:index)?\.html$/,""),"/"===a.charAt(a.length-1)&&(a=a.slice(0,-1)),""===a&&(a=this.url),a.length>40&&-1!==(b=a.indexOf("/"))&&-1!==(c=a.lastIndexOf("/"))&&c!==b&&(b+a.length-c<40&&(c=-(40-(b+1))),a=a.slice(0,b+1)+"â€¦"+a.slice(c)),this.$("#tcb-link-preview").attr("href",this.url).text(a))},get_link_data:function(){return{href:this.get_url(),text:this.get_text(),attr:{target:this.controls.target.checked()?"_blank":null,rel:this.controls.rel.checked()?"nofollow":null}}},set_link_text:function(a){return this.has_link_text?this:(this.$text.val(a),this)},remove_link:function(){return c&&c.execCommand("tcb_unlink"),!0},edit_link:function(){return c&&c.execCommand("TCB_Link"),!0},cancel_link:function(a){return a.preventDefault(),c&&c.execCommand("tcb_link_cancel"),!0},apply_link:function(a){return a.preventDefault(),c&&c.execCommand("tcb_link_apply"),!0}}),j=new i;j.render().hide(),a.PluginManager.add("tcblink",function(b){function e(){var a,c,d=b.selection.getNode(),e=b.dom.getParent(d,"a[href]");return e||(c=b.selection.getContent({format:"raw"}),c&&-1!==c.indexOf("</a>")&&(a=c.match(/href="([^">]+)"/),a&&a[1]&&(e=b.$('a[href="'+a[1]+'"]',d)[0]),e&&b.selection.select(e))),e}function h(){b.$("a").each(function(a,c){c.getAttribute("href")===d?b.dom.remove(c,!0):c.getAttribute("data-tcblink-edit")&&c.removeAttribute("data-tcblink-edit"),c.removeAttribute("data-mce-href")})}function i(a,b){return a.replace(/(<a [^>]+>)([\s\S]*?)<\/a>/g,function(a,c,e){return c.indexOf(' href="'+d+'"')>-1?e:(b&&(c=c.replace(/ data-tcblink-edit="true"/g,"")),c=c.replace(/ data-tcblink-url-error="true"/g,""),c+e+"</a>")})}function k(a){if(a){var c=a.href;c&&(j.has_link_error=!1,!/^http/i.test(c)||f.test(c)&&g.test(c)?a.removeAttribute("data-tcblink-url-error"):(j.has_link_error=!0,a.setAttribute("data-tcblink-url-error","true"),TVE.page_message(b.translate("Warning: the link has been inserted but may have errors. Please test it."),!0)))}}var l;return j.has_link_error=!1,b.addCommand("TCB_Link",function(){l=e(),j.temp_hide=!1,l?b.dom.setAttribs(l,{"data-tcblink-edit":!0}):(h(),b.execCommand("mceInsertLink",!1,{href:d}),l=b.$('a[href="'+d+'"]')[0],b.nodeChanged())}),b.addCommand("tcb_link_apply",function(){if(l){var a=j.get_link_data();if(b.focus(),!a.href)return void b.dom.remove(l,!0);b.dom.setAttribs(l,{href:a.href,"data-tcblink-edit":null}),b.dom.setAttribs(l,a.attr),b.$(l).text(a.text||a.href),j.reset(),b.selection.select(l),k(l)}"undefined"==typeof window.wpLinkL10n||j.has_link_error||TVE.page_message(window.wpLinkL10n.linkInserted)}),b.addCommand("tcb_link_cancel",function(){j.temp_hide||(j.hide(),j.reset(),h())}),b.addCommand("tcb_unlink",function(){b.execCommand("unlink"),j.temp_hide=!1,b.execCommand("tcb_link_cancel")}),b.addShortcut("meta+k","","TCB_Link"),b.addButton("tcblink",{classes:"tcb-link-btn",icon:"link",tooltip:"Insert/edit link",cmd:"TCB_Link",stateSelector:"a[href]"}),b.addButton("unlink",{icon:"unlink",tooltip:"Remove link",cmd:"unlink"}),b.on("pastepreprocess",function(c){var d=c.content,e=/^(?:https?:)?\/\/\S+$/i;b.selection.isCollapsed()||e.test(b.selection.getContent())||(d=d.replace(/<[^>]+>/g,""),d=a.trim(d),e.test(d)&&(b.execCommand("mceInsertLink",!1,{href:b.dom.decode(d)}),c.preventDefault()))}),b.on("BeforeAddUndo",function(a){a.lastLevel&&a.lastLevel.content&&a.level.content&&a.lastLevel.content===i(a.level.content)&&a.preventDefault()}),b.on("keydown",function(a){27===a.keyCode&&b.execCommand("tcb_link_cancel")}),b.on("nodechange",function(a){c=b;var d=b.dom.getParent(a.element,"a");j.temp_hide=!1,d?(j.set_link_node(d).reposition(),j.on_node_change()):j.visible()&&b.execCommand("tcb_link_cancel",!0,{},{skip_focus:!0})}),b.on("blur",function(){h(),j.hide()}),{close:function(){b.execCommand("tcb_link_cancel")},checkLink:k}})}(window.tinymce,window.jQuery);